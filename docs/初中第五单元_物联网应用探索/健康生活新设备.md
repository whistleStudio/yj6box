# ã€Šå¥åº·ç”Ÿæ´»æ–°è®¾å¤‡ã€‹

[[toc]]
<br><br>

<p class="attention">æ³¨ï¼šå®éªŒç½‘ç»œåº”ä¸º2.4G, æ‰‹æœºçƒ­ç‚¹è¯·åˆ‡æ¢è‡³4Gã€‚æœ¬èŠ‚å®éªŒéœ€è¦2å¥—åˆ›è¶£æ˜Ÿç›’ï¼Œè¯¾å ‚æ•™å­¦å¯é‡‡å–å°ç»„åˆä½œå½¢å¼ã€‚</p>

## ğŸ“’ å­¦ä¹ æŒ‡å—

<br>
<object data="/tutorial/starbox_yj/pdf/åˆä¸­ç¬¬22è¯¾å¥åº·ç”Ÿæ´»æ–°è®¾å¤‡.pdf" type="application/pdf" width=1200 height=800 name="å¥åº·ç”Ÿæ´»æ–°è®¾å¤‡">
å½“å‰æµè§ˆå™¨ä¸æ”¯æŒåœ¨çº¿é¢„è§ˆPDF
</object>

<br><br>

## ğŸ“ å®éªŒè®¾è®¡ - ç­çº§èº«é«˜æµ‹é‡ç³»ç»Ÿ

äº†è§£è¶…å£°æ³¢æµ‹èº«é«˜çš„å®ç°æ–¹æ³•ï¼Œä½“éªŒç‰©è”ç½‘é€šè®¯è¿‡ç¨‹ä¸­æ•°æ®çš„å¤„ç†è¿‡ç¨‹ã€‚

- äº†è§£ç‰©è”ç½‘åœ¨ç”Ÿæ´»ä¸­çš„åº”ç”¨ã€‚
- é€šè¿‡èº«é«˜è®°å½•ä»ªç³»ç»Ÿçš„å®è·µæ¢ç´¢ï¼ŒæŒæ¡åˆ©ç”¨ç‰©è”
ç½‘è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼Œå¹¶èƒ½è¿ç§»åº”ç”¨äºè§£å†³å…¶ä»–é—®é¢˜ã€‚

<br><br>

## ğŸ§° å®éªŒå™¨æ

åˆ›è¶£æ˜Ÿç›’æ¿è½½è¶…å£°æ³¢æµ‹è·ä¼ æ„Ÿå™¨ã€WIFI-BLEæ¨¡å—ã€æŒ‰é”®å’Œæ˜¾ç¤ºå±ã€‚

<br><br>

## ğŸŒ° å®éªŒæ¡ˆä¾‹

### ç­çº§èº«é«˜æµ‹é‡ç³»ç»Ÿ
æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨å®æ—¶ç›‘æµ‹ç¯å¢ƒçŠ¶æ€ï¼Œå¹¶å°†æ£€æµ‹æ•°å€¼ä¸ŠæŠ¥ç‰©è”äº‘ç«¯ã€‚

å½“æ¸©åº¦ä¸æ»¡è¶³ç»™å®šåŒºé—´æ—¶ï¼Œé£æ‰‡(æ¨¡æ‹Ÿç©ºè°ƒ)å¯åŠ¨ï¼›å½“æ¹¿åº¦ä¸æ»¡è¶³ç»™å®šåŒºé—´æ—¶ï¼Œå±æ˜¾æ–‡å­—æ˜¾ç¤ºâ€œåŠ æ¹¿å™¨ï¼šæ‰“å¼€â€ã€‚

ä»»æ„è®¾å¤‡å¯åŠ¨æ—¶é•¿è¶…è¿‡ç»™å®šæ—¶é—´æ—¶ï¼Œèœ‚é¸£å™¨å‘å‡ºè­¦æŠ¥ã€‚

<a href="https://www.cfunworld.com" target="_blank">ç‚¹å‡»æŸ¥çœ‹æ¼”ç¤ºè§†é¢‘</a>


#### ã€å›¾å½¢åŒ–ç¨‹åºç¤ºä¾‹ã€‘

- å‘é€ç«¯

ä½œä¸ºè®¾å¤‡1æ¥å…¥ç‰©è”ç½‘æœåŠ¡ï¼Œå‘é€è®¾å¤‡1ä¸»é¢˜æ¶ˆæ¯ï¼›

åˆ©ç”¨è¶…å£°æ³¢æµ‹è·ä¼ æ„Ÿå™¨é‡‡é›†å­¦ç”Ÿèº«é«˜ï¼Œæ ¹æ®æ€§åˆ«ï¼ŒæŒ‰ä¸‹ä¸åŒæŒ‰é”®ï¼Œåˆ†åˆ«å‘é€ç›¸åº”ä¸»é¢˜è‡³ç‰©è”ç½‘æœåŠ¡ç«¯ã€‚

<a href="/tutorial/starbox_yj/sb3/15/ç­çº§èº«é«˜æµ‹é‡ç³»ç»Ÿï¼ˆå‘é€ç«¯ï¼‰.sb3">ç‚¹å‡»ä¸‹è½½ç¨‹åº: ç­çº§èº«é«˜æµ‹é‡ç³»ç»Ÿï¼ˆå‘é€ç«¯ï¼‰.sb3</a>

<img src="/images/15/ç­çº§èº«é«˜æµ‹é‡ç³»ç»Ÿï¼ˆå‘é€ç«¯ï¼‰.png">

- æ¥æ”¶ç«¯

ä½œä¸ºè®¾å¤‡2æ¥å…¥ç‰©è”ç½‘æœåŠ¡ï¼Œè®¢é˜…è®¾å¤‡1ä¸»é¢˜æ¶ˆæ¯ï¼›

æ ¹æ®æ¥æ”¶çš„ä¸åŒä¸»é¢˜ï¼Œæ·»åŠ ç›¸åº”ä¿¡æ¯è‡³æœ¬åœ°åˆ—è¡¨ï¼Œå±å¹•å®æ—¶æ˜¾ç¤ºå·²é‡‡é›†çš„ç­çº§å­¦ç”Ÿèº«é«˜æ•°æ®ã€‚

<a href="/tutorial/starbox_yj/sb3/15/ç­çº§èº«é«˜æµ‹é‡ç³»ç»Ÿï¼ˆæ¥æ”¶ç«¯ï¼‰.sb3">ç‚¹å‡»ä¸‹è½½ç¨‹åº: ç­çº§èº«é«˜æµ‹é‡ç³»ç»Ÿï¼ˆå‘é€ç«¯ï¼‰.sb3</a>

<img src="/images/15/ç­çº§èº«é«˜æµ‹é‡ç³»ç»Ÿï¼ˆæ¥æ”¶ç«¯ï¼‰.png">

#### ã€ä»£ç ç¤ºä¾‹ã€‘

- å‘é€ç«¯

```python
#python
""" ç­çº§èº«é«˜æµ‹é‡ç³»ç»Ÿï¼ˆå‘é€ç«¯ï¼‰ """
from pyb import Pin
from pyb import MqttBle
from pyb import TFT
from time import sleep_ms
from pyb import Ultrasonic
from pyb import BoardKey

mqttBle = MqttBle(2, 230400)
tft = TFT()
ultC4 = Ultrasonic("C4")
boardKeyL = BoardKey("left")
boardKeyR = BoardKey("right")

def è”ç½‘é…ç½®():
  Pin("E2", Pin.OUT_PP)(1)
  Pin("E4", Pin.OUT_PP)(1)
  while not mqttBle.checkWiFi():
    mqttBle.connectWiFi("chuchu", "19930304wsh")

  Pin("E2", Pin.OUT_PP)(0)
  mqttBle.connectMqtt("iot.cfunworld.com", 1883, "whistle", 1, "abcdefg")
  while not mqttBle.checkMqtt():
    pass
  Pin("E4", Pin.OUT_PP)(0)

def æ˜¾ç¤º():
  global èº«é«˜
  tft.clear("#ffffff")
  tft.displayChinese(0, 0, "ç­çº§èº«é«˜æµ‹é‡ç³»ç»Ÿï¼ˆå‘é€ç«¯ï¼‰", "font24", "#4997da", "#42ba89", 0)
  tft.displayChinese(0, 30, "èº«é«˜ï¼š" + str(èº«é«˜) + "cm", "font24", "#da781a", "#42ba89", 0)
  sleep_ms(int(0.2 * 1000))

è”ç½‘é…ç½®()
while True:
  èº«é«˜ = ultC4.readDistance()
  æ˜¾ç¤º()
  if boardKeyL.value():
    while boardKeyL.value():
      pass
    mqttBle.publishStr("male", str(èº«é«˜))
    sleep_ms(int(2 * 1000))

  if boardKeyR.value():
    while boardKeyR.value():
      pass
    mqttBle.publishStr("female", str(èº«é«˜))
    sleep_ms(int(2 * 1000))
```

- æ¥æ”¶ç«¯

```python
#python
""" ç­çº§èº«é«˜æµ‹é‡ç³»ç»Ÿï¼ˆæ¥æ”¶ç«¯ï¼‰"""
from pyb import Pin
from pyb import MqttBle
from time import sleep_ms
from pyb import TFT

èº«é«˜åˆ—è¡¨ = []
mqttBle = MqttBle(2, 230400)
tft = TFT()

def è”ç½‘é…ç½®():
  Pin("E2", Pin.OUT_PP)(1)
  Pin("E4", Pin.OUT_PP)(1)
  while not mqttBle.checkWiFi():
    mqttBle.connectWiFi("chuchu", "19930304wsh")

  Pin("E2", Pin.OUT_PP)(0)
  mqttBle.connectMqtt("iot.cfunworld.com", 1883, "whistle", 2, "abcdefg")
  while not mqttBle.checkMqtt():
    pass
  Pin("E4", Pin.OUT_PP)(0)
  mqttBle.subscribe(1, "male")
  sleep_ms(2 * 1000)
  mqttBle.subscribe(1, "female")

def æ˜¾ç¤º():
  global ç´¢å¼•
  tft.clear("#ffffff")
  tft.displayChinese(0, 0, "ç­çº§èº«é«˜æµ‹é‡ç³»ç»Ÿï¼ˆæ¥æ”¶ç«¯ï¼‰", "font24", "#4997da", "#42ba89", 0)
  ç´¢å¼• = 0
  for i in range(len(èº«é«˜åˆ—è¡¨)):
    ç´¢å¼• += 1
    tft.displayChinese(0, 20 * ç´¢å¼•, èº«é«˜åˆ—è¡¨[ç´¢å¼• - 1], "font16", "#da781a", "#42ba89", 0)

  sleep_ms(int(0.2 * 1000))

è”ç½‘é…ç½®()
del èº«é«˜åˆ—è¡¨[0:]
while True:
  æ˜¾ç¤º()
  if mqttBle.readMqttData(1, "male"):
    èº«é«˜åˆ—è¡¨.append("ç”·ï¼š" + mqttBle.mqttBle_string() + "cm")

  if mqttBle.readMqttData(1, "female"):
    èº«é«˜åˆ—è¡¨.append("å¥³ï¼š" + mqttBle.mqttBle_string() + "cm")
```